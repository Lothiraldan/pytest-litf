#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""Pytest-LITF launcher
"""

from __future__ import print_function, absolute_import, division

import os
import sys
import json


def run(args):
    config = args.config

    collect_only = bool(config.get("collect-only", False))
    files = config.get("files", [])
    nodeids = config.get("nodeids", [])

    # Create the command line to launch
    cmd = ["pytest", "--litf", "--fulltrace", "--capture=sys"]

    if collect_only:
        cmd.append("--collectonly")

    if nodeids:
        cmd.extend(nodeids)
    if files:
        cmd.extend(files)

    # Replace current process with the cmd
    os.execvp("pytest", cmd)


if '__main__' == __name__:
    import argparse
    parser = argparse.ArgumentParser(description=__doc__)
    parser.add_argument('config', help='''JSON config, example: '{"collect-only": true}')''', type=json.loads)

    args = parser.parse_args()
    run(args)
